<div class="profile-page">
  <p-toast></p-toast>

  <div class="profile-card">
    <div class="card-header">
      <div class="profile-icon">
        <i class="pi pi-user"></i>
      </div>
      <h1>{{ 'MY-PROFILE' | translate }}</h1>
    </div>

    <form [formGroup]="profileForm" class="profile-form">
      <!-- Personal Information Section -->
      <div class="form-section">
        <div class="form-grid">
          <div class="form-field">
            <label for="lastName">
              <i class="pi pi-user"></i>
              {{ 'LASTNAME' | translate }}
            </label>
            <div class="input-container" [class.disabled]="!editable">
              <input
                id="lastName"
                formControlName="lastName"
                type="text"
                pInputText
                [disabled]="!editable"
              />
            </div>
            <div *ngIf="profileForm.controls['lastName'].invalid && profileForm.controls['lastName'].touched"
                 class="error-message">
              <i class="pi pi-exclamation-circle"></i>
              <span>{{ 'REQUIRED_FIELD' | translate }}</span>
            </div>
          </div>

          <div class="form-field">
            <label for="firstName">
              <i class="pi pi-user"></i>
              {{ 'FIRSTNAME' | translate }}
            </label>
            <div class="input-container" [class.disabled]="!editable">
              <input
                id="firstName"
                formControlName="firstName"
                type="text"
                pInputText
                [disabled]="!editable"
              />
            </div>
            <div *ngIf="profileForm.controls['firstName'].invalid && profileForm.controls['firstName'].touched"
                 class="error-message">
              <i class="pi pi-exclamation-circle"></i>
              <span>{{ 'REQUIRED_FIELD' | translate }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Contact Information Section -->
      <div class="form-section">
        <div class="form-grid">
          <div class="form-field">
            <label for="email">
              <i class="pi pi-at"></i>
              {{ 'EMAIL' | translate }}
            </label>
            <div class="input-container readonly">
              <input
                id="email"
                formControlName="email"
                type="email"
                pInputText
                [attr.disabled]="true"
                [attr.readonly]="true"
                [disabled]="false"
              />
              <div class="readonly-badge">
                <i class="pi pi-lock"></i>
              </div>
            </div>
            <div *ngIf="profileForm.controls['email'].invalid && profileForm.controls['email'].touched"
                 class="error-message">
              <i class="pi pi-exclamation-circle"></i>
              <span>{{ 'REQUIRED_FIELD' | translate }}</span>
            </div>
          </div>

          <div class="form-field">
            <label for="phoneNumber">
              <i class="pi pi-phone"></i>
              {{ 'PHONE_NUMBER' | translate }}
            </label>
            <div class="input-container" [class.disabled]="!editable">
              <input
                id="phoneNumber"
                formControlName="phoneNumber"
                type="text"
                pInputText
                [disabled]="!editable"
              />
            </div>
            <div *ngIf="profileForm.controls['phoneNumber'].invalid && profileForm.controls['phoneNumber'].touched"
                 class="error-message">
              <i class="pi pi-exclamation-circle"></i>
              <span>{{ 'INVALID_PHONE' | translate }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Personal Details Section -->
      <div class="form-section">
        <div class="form-grid">
          <div class="form-field">
            <label for="dateOfBirth">
              <i class="pi pi-calendar"></i>
              {{ 'DATE_OF_BIRTH' | translate }}
            </label>
            <p-calendar
              id="dateOfBirth"
              formControlName="dateOfBirth"
              [showIcon]="true"
              dateFormat="dd.mm.yy"
              [disabled]="!editable"
              [showButtonBar]="true"
              [firstDayOfWeek]="1"
              styleClass="custom-calendar"
              appendTo="body"
            ></p-calendar>
            <div *ngIf="profileForm.controls['dateOfBirth'].invalid && profileForm.controls['dateOfBirth'].touched"
                 class="error-message">
              <i class="pi pi-exclamation-circle"></i>
              <span>{{ 'DATE_REQUIRED' | translate }}</span>
            </div>
            <div
              *ngIf="profileForm.get('dateOfBirth')?.hasError('invalidDate') && profileForm.get('dateOfBirth')?.touched"
              class="error-message">
              <i class="pi pi-exclamation-circle"></i>
              <span>{{ 'FUTURE_DATE' | translate }}</span>
            </div>
          </div>

          <div class="form-field">
            <label for="annualIncome">
              <i class="pi pi-dollar"></i>
              {{ 'ANNUAL_INCOME' | translate }}
            </label>
            <div class="input-container" [class.disabled]="!editable">
              <input
                id="annualIncome"
                formControlName="annualIncome"
                type="number"
                pInputText
                [disabled]="!editable"
              />
            </div>
            <div *ngIf="profileForm.controls['annualIncome'].invalid && profileForm.controls['annualIncome'].touched"
                 class="error-message">
              <i class="pi pi-exclamation-circle"></i>
              <span>{{ 'POSITIVE_INCOME' | translate }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Family Information Section -->
      <div class="form-section">
        <div class="form-grid">
          <div class="form-field">
            <label for="maritalStatus">
              <i class="pi pi-heart"></i>
              {{ 'MARITAL_STATUS' | translate }}
            </label>
            <div class="select-wrapper">
              <select
                id="maritalStatus"
                formControlName="maritalStatus"
                [disabled]="!editable"
                class="custom-select"
              >
                <option value="">{{ 'SELECT' | translate }}</option>
                <option *ngFor="let status of maritalStatuses" [value]="status.value">
                  {{ status.label }}
                </option>
              </select>
              <div class="select-arrow">
                <i class="pi pi-chevron-down"></i>
              </div>
            </div>
            <div *ngIf="profileForm.controls['maritalStatus'].invalid && profileForm.controls['maritalStatus'].touched"
                 class="error-message">
              <i class="pi pi-exclamation-circle"></i>
              <span>{{ 'REQUIRED_FIELD' | translate }}</span>
            </div>
          </div>

          <div class="form-field">
            <label for="numberOfChildren">
              <i class="pi pi-users"></i>
              {{ 'NUMBER_OF_CHILDREN' | translate }}
            </label>
            <div class="input-container" [class.disabled]="!editable">
              <input
                id="numberOfChildren"
                formControlName="numberOfChildren"
                type="number"
                pInputText
                [disabled]="!editable"
              />
            </div>
            <div
              *ngIf="profileForm.controls['numberOfChildren'].invalid && profileForm.controls['numberOfChildren'].touched"
              class="error-message">
              <i class="pi pi-exclamation-circle"></i>
              <span>{{ 'POSITIVE_INTEGER' | translate }}</span>
            </div>
          </div>
        </div>
      </div>

      <div class="form-actions">
        <button
          pButton
          [label]="editable ? ('CANCEL' | translate) : ('EDIT' | translate)"
          [icon]="editable ? 'pi pi-times' : 'pi pi-pencil'"
          (click)="toggleEdit()"
          type="button"
          class="edit-button"
          [class.editing]="editable"
        ></button>

        <button
          pButton
          label="{{ 'VALIDATE' | translate }}"
          icon="pi pi-check"
          (click)="submitForm()"
          [disabled]="!profileForm.valid || !editable"
          type="button"
          class="validate-button"
        ></button>
      </div>
    </form>
  </div>
</div>
